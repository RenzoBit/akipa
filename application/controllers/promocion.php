<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');class promocion extends CI_Controller {	function __construct()	{		parent::__construct();	}	function index()	{		$this->load->model(array('promocion_model','campana_model'));		$lista_promocion = $this->promocion_model->getPromociones();		foreach($lista_promocion as &$promocion){			$promocion['campana'] = $promocion['idcampana'] > 0 ? $this->campana_model->getCampanaPorId($promocion['idcampana']) : false;		}		$data_template['data']['lista_promocion'] = $lista_promocion;		$data_template['titulo_pagina'] ='Lista de Promociones';		$data_template['vista'] ='promocion_lista';		$this->load->view('template', $data_template);	}	function nuevo(){		$this->load->model(array('plato_model'));		//Lista de platos para elegir		$lista_platos = $this->plato_model->getPlatos();		$data_template['data']['lista_platos'] = $lista_platos;		$data_template['titulo_pagina'] ='Agregar Nueva Promoción';		$data_template['vista'] ='promocion_nuevo';		$this->load->view('template', $data_template);	}	function editar($idplato){		$this->load->model(array('plato_model', 'categoria_model'));		$plato = $this->plato_model->getPlatoPorId($idplato);		$lista_categorias = $this->categoria_model->getCategorias();		foreach ($lista_categorias as $categoria) {			$cbocategorias[$categoria['idcategoria']] = $categoria['nombre'];		}		$data_template['data']['cbocategorias'] = $cbocategorias;		$data_template['data']['plato'] = $plato[0];		$data_template['titulo_pagina'] ='Editar Plato';		$data_template['vista'] ='editar_plato';		$this->load->view('template', $data_template);	}	function guardar(){		//Recuperar y validar todas las variables recibidas		$nombre_promocion = $this->input->post('nombre_promocion');		$codigo_promocion = $this->input->post('codigo_promocion');		$fecha_inicio = $this->input->post('fecha_inicio');		$fecha_fin = $this->input->post('fecha_fin');		$minimo_platos = $this->input->post('minimo_platos');		$lista_platos = $this->input->post('lista_platos');		$precio_unitario = $this->input->post('precio_unitario');		$porcentaje_descuento = $this->input->post('porcentaje_descuento');		//TODO Validar que el plato exista, que la categoria exista y que los otros valores estén en los rangos esperados		$this->load->model('promocion_model');		$respuesta = $this->promocion_model->agregarPromocion($nombre_promocion, $codigo_promocion, $fecha_inicio, $fecha_fin);		if (!$respuesta){			redirect('plato/editar/' . $idplato);		}		$this->index();	}	function eliminar($idplato){		//TODO Validar que el plato exista, que la categoria exista y que los otros valores estén en los rangos esperados		$this->load->model('plato_model');		$respuesta = $this->plato_model->deletePlato($idplato);				$this->index();	}}/* End of file welcome.php *//* Location: ./system/application/controllers/welcome.php */